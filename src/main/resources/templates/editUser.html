<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0" />
    <title>Products</title>

    <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" />
    <script type="text/javascript" th:src="@{/webjars/jquery/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>
</head>

<body>
<div th:replace="fragments/header :: header"></div>

<div class="container-fluid">
<!--    <h2 class="text-center">[[${pageTitle}]]</h2>-->

    <div class="my-3">
        <form th:action="@{/users/saveDto}" method="post" enctype="multipart/form-data" th:object="${dto}"
              style="max-width: 570px; margin: 0 auto">
            <!--        type="hidden"-->
            <input type="hidden"  th:field="*{id}" />
            <div class="form-group row">
                <label class="col-sm-3 col-form-label" for="username">username</label>
                <div class="col-sm-9">
                    <input type="text" th:field="*{username}" required minlength="2" maxlength="128" class="form-control"
                           id="username" />
                </div>
            </div>

            <div class="p-3">
                <div class="form-group row">
                    <label class="col-sm-3 col-form-label" for="email">email</label>
                    <div class="col-sm-9">
                        <input type="text" th:field="*{email}" required minlength="2" maxlength="128" class="form-control"
                               id="email" />
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-3 col-form-label" for="role">role</label>
                    <div class="col-sm-9">
                        <input type="text" th:field="*{role}" minlength="2" maxlength="256" class="form-control"
                               id="role" />
                    </div>
                </div>

<!--                <div class="form-group row">-->
<!--                    <label class="col-sm-3 col-form-label" for="level">Level</label>-->
<!--                    <div class="col-sm-9">-->
<!--                        <input type="number" step="1" th:field="*{level}" required min="1"-->
<!--                               class="form-control" id="level" />-->
<!--                    </div>-->
<!--                </div>-->

                <div class="form-group row">
                    <label class="col-sm-3 form-check-label" for="enabled">enabled</label>
                    <div class="col-sm-9">
                        <input type="checkbox" id="enabled" th:field="*{enabled}" />
                    </div>
                </div>

                <!--          <input type="hidden"  th:field="*{id}" />-->

                <input  type="hidden" th:field="*{userImage}"/>



                <div class="form-group row">
                    <label class="col-sm-3 col-form-label" for="file">Image</label>
                    <div class="col-sm-9">


                        <input id="file" type="file" name="file"  accept="image/png, image/jpeg"   />
                        <img src="" id="prev" th:src="@{'data:image/jpeg;base64,'+${dto.getImageDataBase64()}}" alt="Preview" style="max-width: 50px; max-height: 50px"/>

                    </div>
                </div>


                <div class="text-center">

                    <input type="submit" value="Save" class="btn btn-primary btn-sm mr-2" />
                    <input type="button" value="Cancel" id="btnCancel" class="btn btn-secondary btn-sm" />
<!--                    <button id="deleteImageButton" class="btn btn-secondary btn-sm">-->
<!--                        <a id="deleteImageHl" th:href="@{'/delete/'+ ${product.id}}">delete Image</a>-->
<!--                    </button>-->

                </div>
            </div>
        </form>
    </div>
</div>



<div th:replace="fragments/footer :: footer"></div>

<script type="text/javascript">
    $(document).ready(function () {
      $("#btnCancel").on("click", function () {
        window.location = "[[@{/products}]]";
      });
    });

<!--&lt;!&ndash;обработка размера файла входящего&ndash;&gt;-->
<!--    document.getElementsByName('file')[0].addEventListener('change', function(event) {-->
<!--&lt;!&ndash;        alert("The button was clicked!" + (this.files[0].size/ 1024 / 1024).toFixed(2));&ndash;&gt;-->

<!--        const size =-->
<!--               (this.files[0].size / 1024 / 1024).toFixed(2);-->

<!--        if (size > 1 ) {-->
<!--                alert("File size must be less than1 MB");-->
<!--                document.getElementById('file').value= null;-->
<!--            } else {-->
<!--                  var reader = new FileReader();-->
<!--                  reader.onload = function(r_event) {-->
<!--                    document.getElementById('prev').setAttribute('src', r_event.target.result);-->
<!--                  }-->
<!--            reader.readAsDataURL(this.files[0]);-->
<!--            }-->
<!--    });-->

    document.getElementById('file').addEventListener('change', function (event) {
        const file = event.target.files[0]; // Get the selected file

        if (file) {
            const reader = new FileReader();

            // When the file is loaded, set it as the image source
            reader.onload = function (e) {
                document.getElementById('prev').src = e.target.result; // Set the preview image
            };

            // Read the file as a data URL
            reader.readAsDataURL(file);
        } else {
            document.getElementById('prev').src = ''; // Clear the preview if no file is selected
        }
    });
  </script>

</body>

</html>